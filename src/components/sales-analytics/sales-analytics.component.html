<div class="space-y-8">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <h2 class="text-3xl font-bold text-slate-800">Sales Analytics</h2>
    <div class="flex items-center space-x-1 bg-slate-200 p-1 rounded-lg">
      <button (click)="setDateRange('7d')" [class]="dateRangeButtonClass('7d')">Last 7 Days</button>
      <button (click)="setDateRange('30d')" [class]="dateRangeButtonClass('30d')">Last 30 Days</button>
      <button (click)="setDateRange('all')" [class]="dateRangeButtonClass('all')">All Time</button>
    </div>
  </div>


  @if (totalOrders() === 0) {
    <div class="text-center py-16 bg-white rounded-xl shadow-md border border-slate-200">
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
      </svg>
      <p class="mt-4 text-slate-500">No sales data available for this period. Complete an order to see analytics.</p>
    </div>
  } @else {
    <!-- Stat Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
      <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 flex items-start justify-between">
        <div>
          <h3 class="text-sm font-medium text-slate-500">Total Revenue</h3>
          <p class="text-3xl font-bold text-slate-800 mt-2">{{ totalRevenue() | currency }}</p>
        </div>
        <div class="bg-blue-100 text-blue-600 p-2 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01" /></svg></div>
      </div>
       <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 flex items-start justify-between">
        <div>
          <h3 class="text-sm font-medium text-slate-500">Total Profit</h3>
          <p class="text-3xl font-bold text-emerald-600 mt-2">{{ totalProfit() | currency }}</p>
        </div>
        <div class="bg-emerald-100 text-emerald-600 p-2 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg></div>
      </div>
       <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 flex items-start justify-between">
        <div>
          <h3 class="text-sm font-medium text-slate-500">Profit Margin</h3>
          <p class="text-3xl font-bold text-emerald-600 mt-2">{{ profitMargin() | number:'1.1-1' }}%</p>
        </div>
         <div class="bg-emerald-100 text-emerald-600 p-2 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" /></svg></div>
      </div>
      <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 flex items-start justify-between">
        <div>
          <h3 class="text-sm font-medium text-slate-500">Total Orders</h3>
          <p class="text-3xl font-bold text-slate-800 mt-2">{{ totalOrders() }}</p>
        </div>
         <div class="bg-blue-100 text-blue-600 p-2 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg></div>
      </div>
      <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 flex items-start justify-between">
        <div>
          <h3 class="text-sm font-medium text-slate-500">Avg. Order Value</h3>
          <p class="text-3xl font-bold text-slate-800 mt-2">{{ averageOrderValue() | currency }}</p>
        </div>
         <div class="bg-blue-100 text-blue-600 p-2 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg></div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Sales Chart -->
      <div class="lg:col-span-2 bg-white rounded-xl shadow-md border border-slate-200 p-6">
        <h3 class="text-xl font-semibold text-slate-700 mb-4">Daily Revenue</h3>
        <div class="relative h-96">
          <canvas #salesChart></canvas>
        </div>
      </div>

      <!-- Top Selling Products -->
      <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6">
        <h3 class="text-xl font-semibold text-slate-700 mb-4">Top Products by Revenue</h3>
        <div class="relative h-64 mb-4">
          <canvas #topProductsChart></canvas>
        </div>
        <h4 class="text-lg font-semibold text-slate-700 mb-2 mt-6">Top Profit-Driving Products</h4>
        <ul class="space-y-3">
          @for (product of topProfitProducts().slice(0, 5); track product.name; let i = $index) {
            <li class="flex items-center space-x-3">
              <div class="flex-shrink-0 w-8 h-8 bg-slate-200 text-slate-600 rounded-full flex items-center justify-center font-bold text-sm">
                {{ i + 1 }}
              </div>
              <div class="flex-grow">
                <p class="font-semibold text-slate-800 text-sm">{{ product.name }}</p>
                <p class="text-xs text-slate-500">{{ product.quantity }} units sold</p>
              </div>
              <div class="text-right">
                <p class="font-bold text-emerald-600 text-sm">{{ product.profit | currency }}</p>
              </div>
            </li>
          } @empty {
            <li class="text-center text-slate-500 py-4">No product data to display.</li>
          }
        </ul>
      </div>
    </div>
  }
</div>